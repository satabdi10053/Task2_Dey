bronze_path = "abfss://BF_Bronze@basicfitete.dfs.core.windows.net/" 
df_bronze = ( spark.readStream .format("cloudFiles") 
.option("cloudFiles.format", "delta") 
.option("cloudFiles.schemaLocation", "abfss://BF_raw@basicfitete.dfs.core.windows.net/member_checkpoint") 
.load("abfss://BF_raw@basicfitete.dfs.core.windows.net/member") 
.withColumn("ingestion_ts", current_timestamp())
)
( 
df_bronze_stream.writeStream .format("delta") 
.option("checkpointLocation", f"{bronze_path}/_checkpoint") 
.outputMode("append")
.trigger(once=true)
.start(bronze_path/member) 
)

bronze_path = "abfss://BF_Bronze@basicfitete.dfs.core.windows.net" 
df_bronze = ( spark.readStream .format("cloudFiles") 
.option("cloudFiles.format", "delta") 
.option("cloudFiles.schemaLocation", "abfss://BF_raw@basicfitete.dfs.core.windows.net/club_checkpoint") 
.load("abfss://BF_raw@basicfitete.dfs.core.windows.net/club") 
.withColumn("ingestion_ts", current_timestamp())
)
( 
df_bronze_stream.writeStream .format("delta") 
.option("checkpointLocation", f"{bronze_path}/_checkpoint") 
.outputMode("append") 
.trigger(once=true)
.start(bronze_path/club) 
)

bronze_path = "abfss://BF_Bronze@basicfitete.dfs.core.windows.net" 
df_bronze = ( spark.readStream .format("cloudFiles") 
.option("cloudFiles.format", "delta") 
.option("cloudFiles.schemaLocation", "abfss://BF_raw@basicfitete.dfs.core.windows.net/visit_checkpoint") 
.load("abfss://BF_raw@basicfitete.dfs.core.windows.net/visit") 
.withColumn("ingestion_ts", current_timestamp())
)
( 
df_bronze_stream.writeStream .format("delta") 
.option("checkpointLocation", f"{bronze_path}/_checkpoint") 
.outputMode("append")  
.trigger(once=true)
.start(bronze_path/visit)
)


%sql
CREATE TABLE Lakeflow_BF.BF_Bronze.Member USING DELTA LOCATION 'abfss://BF_Bronze@basicfitete.dfs.core.windows.net/member';
CREATE TABLE Lakeflow_BF.BF_Bronze.club USING DELTA LOCATION 'abfss://BF_Bronze@basicfitete.dfs.core.windows.net/club';
CREATE TABLE Lakeflow_BF.BF_Bronze.visit USING DELTA LOCATION 'abfss://BF_Bronze@basicfitete.dfs.core.windows.net/visit';
